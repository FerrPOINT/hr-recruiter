# Промпт для разработки бэкенда HR Recruiter API


! используй последний спринг последнюю джаву, 
! Разработай масштабируемое и расширяемое Spring Boot приложение с чистой архитектурой, REST API, обработкой ошибок и интеграцией с базой данных (PostgreSQL). 
! По Spring используй Проперти вместо @Value
! Пиши коментарии в сложных местах
! Используй лучшие практики Spring (DI, JPA, AOP) и обеспечь готовность к деплою в Docker.
! Придерживайся подходов джава и её синтаксиса и соглашений
! Используй подходы SOLID и Design Patterns DDD и прочие


## Описание проекта

Разработайте полнофункциональный REST API для платформы автоматизации HR-собеседований на основе предоставленной OpenAPI спецификации. Приложение должно поддерживать управление вакансиями, кандидатами, собеседованиями с AI-ассистентом, а также предоставлять аналитику и отчеты.

## Технические требования

### Технологический стек
- **Язык программирования**: Java/Spring Boot
- **База данных**: PostgreSQL
- **Аутентификация**: Basic Auth (email/password) с возможностью перехода на JWT
- **Документация и генерация интерфейсов для контроллеров**: OpenAPI 3.0
- **Тестирование**: Unit и интеграционные тесты
- **Логирование**: Структурированные логи
- **Валидация**: Строгая валидация входных данных

### Архитектурные требования
- RESTful API архитектура
- Модульная структура кода
- Dependency Injection
- Repository pattern для работы с БД
- Middleware для аутентификации и авторизации
- Error handling с детальными сообщениями
- CORS настройки для фронтенда
- Использование lombok везде где можно
- Использование новых технологий, использование claude и возможно как альтернативу чатгпт

## Основные модули системы

### 1. Аутентификация и авторизация (`/auth`)
- **POST /auth/login** - Вход пользователя с email/password
- **POST /auth/logout** - Выход пользователя
- Basic Auth с email/password (для начала)
- Роли: admin, recruiter, viewer
- Middleware для проверки прав доступа

### 2. Управление аккаунтом (`/account`)
- **GET /account** - Получение профиля текущего пользователя
- **PUT /account** - Обновление профиля пользователя
- Управление аватарами и настройками языка

### 3. Управление вакансиями (`/positions`)
- **GET /positions** - Список вакансий с фильтрацией по статусу и поиском
- **POST /positions** - Создание новой вакансии
- **GET /positions/{id}** - Детали вакансии
- **PUT /positions/{id}** - Обновление вакансии
- **PATCH /positions/{id}** - Частичное обновление (архивация)
- **DELETE /positions/{id}** - Удаление вакансии (архивация)
- **GET /positions/{id}/public-link** - Публичная ссылка
- **GET /positions/{id}/stats** - Статистика по вакансии

### 4. Управление вопросами (`/questions`)
- **GET /positions/{positionId}/questions** - Вопросы по вакансии
- **POST /positions/{positionId}/questions** - Добавление вопроса
- **PUT /questions/{id}** - Обновление вопроса
- **DELETE /questions/{id}** - Удаление вопроса
- Типы вопросов: text, audio, video, choice

### 5. Управление кандидатами (`/candidates`)
- **GET /positions/{positionId}/candidates** - Кандидаты по вакансии
- **POST /positions/{positionId}/candidates** - Добавление кандидата
- **GET /candidates/{id}** - Детали кандидата
- **PUT /candidates/{id}** - Обновление кандидата
- **DELETE /candidates/{id}** - Удаление кандидата
- Статусы: new, in_progress, finished, rejected, hired

### 6. Управление собеседованиями (`/interviews`)
- **POST /candidates/{candidateId}/interview** - Создание собеседования
- **GET /interviews** - Список всех собеседований с фильтрацией
- **GET /interviews/{id}** - Детали собеседования
- **POST /interviews/{id}/start** - Начало собеседования
- **POST /interviews/{id}/answer** - Отправка ответа на вопрос
- **POST /interviews/{id}/finish** - Завершение собеседования
- **GET /positions/{positionId}/interviews** - Собеседования по вакансии
- Статусы: not_started, in_progress, finished
- Результаты: successful, unsuccessful

### 7. AI интеграция (`/ai`)
- **POST /ai/transcribe** - Транскрибация аудио в текст
- **POST /ai/generate-questions** - Генерация вопросов на основе описания вакансии
- Обработка аудио ответов
- Анализ ответов и выставление оценок
- Интеграция с внешними AI сервисами

### 8. Управление командой (`/users`)
- **GET /users** - Список пользователей
- **POST /users** - Создание пользователя
- **GET /users/{id}** - Детали пользователя
- **PUT /users/{id}** - Обновление пользователя
- **DELETE /users/{id}** - Удаление пользователя

### 9. Настройки системы
- **GET/PUT /branding** - Настройки брендинга компании
- **GET/POST /tariffs** - Управление тарифными планами
- **GET/PUT/DELETE /tariffs/{id}** - Детали и обновление тарифов
- **GET /tariff/info** - Информация о текущем тарифе пользователя

### 10. Аналитика и отчеты
- **GET /reports** - Месячные отчеты по собеседованиям
- **GET /stats/interviews** - Статистика по интервью
- **GET /stats/positions** - Статистика по вакансиям
- **GET /stats/candidates** - Статистика по кандидатам

### 11. Дополнительные модули
- **GET /archive** - Архив данных
- **GET /learn** - Обучающие материалы
- **GET /team** - Информация о команде

## Структура базы данных

### Основные таблицы:
1. **users** - Пользователи системы
2. **positions** - Вакансии
3. **questions** - Вопросы для собеседований
4. **candidates** - Кандидаты
5. **interviews** - Собеседования
6. **interview_answers** - Ответы на вопросы
7. **branding** - Настройки брендинга
8. **tariffs** - Тарифные планы
9. **position_stats** - Статистика по вакансиям
10. **monthly_reports** - Месячные отчеты

### Связи:
- Пользователи могут создавать вакансии
- Вакансии содержат вопросы
- Кандидаты привязаны к вакансиям
- Собеседования связывают кандидатов с вакансиями
- Ответы привязаны к собеседованиям и вопросам

## Бизнес-логика

### Процесс собеседования:
1. Создание вакансии с вопросами
2. Добавление кандидата к вакансии
3. Создание собеседования для кандидата
4. Начало собеседования (генерация вопросов)
5. Получение ответов от кандидата
6. AI анализ ответов и выставление оценок
7. Завершение собеседования с результатом

### Система оценок:
- AI анализирует текстовые и аудио ответы
- Выставляет баллы от 0 до 100
- Определяет успешность собеседования
- Генерирует рекомендации

### Права доступа:
- **Admin**: Полный доступ ко всем функциям
- **Recruiter**: Создание вакансий, управление кандидатами, просмотр отчетов
- **Viewer**: Только просмотр данных

## API Endpoints детализация

### Аутентификация
```typescript
// POST /auth/login
{
  "email": "user@example.com",
  "password": "password123"
}

// Response
{
  "token": "jwt_token_here",
  "user": {
    "id": "uuid",
    "name": "User Name",
    "email": "user@example.com",
    "role": "recruiter",
    "avatarUrl": "https://example.com/avatar.jpg",
    "language": "Русский"
  }
}
```

### Вакансии
```typescript
// POST /positions
{
  "title": "Senior Frontend Developer",
  "description": "Описание вакансии",
  "status": "active",
  "team": ["user_id_1", "user_id_2"],
  "topics": ["JavaScript", "React", "TypeScript"],
  "minScore": 7.0
}

// GET /positions?status=active&search=developer&page=1&size=20
```

### Собеседования
```typescript
// POST /interviews/{id}/answer
{
  "questionId": "uuid",
  "answerText": "Мой ответ на вопрос",
  "audioUrl": "https://storage.example.com/audio.mp3",
  "transcript": "Транскрибация аудио"
}
```

### AI интеграция
```typescript
// POST /ai/generate-questions
{
  "description": "Описание вакансии",
  "questionsCount": 10
}

// POST /ai/transcribe
// multipart/form-data с аудио файлом
```

## Требования к реализации

### 1. Аутентификация
- **Начальная версия**: Basic Auth с email/password
- **Будущая версия**: JWT токены с refresh механизмом
- Хеширование паролей с использованием BCrypt
- Middleware для проверки аутентификации

### 2. Валидация данных
- Строгая валидация всех входных данных
- Использование Bean Validation
- Кастомные валидаторы для бизнес-логики
- Безопасные сообщения об ошибках

### 3. Обработка ошибок
- Централизованная обработка исключений
- Стандартизированные HTTP коды ответов
- Детальные сообщения об ошибках для разработчиков
- Логирование всех ошибок

### 4. Безопасность
- CORS настройки для фронтенда
- Защита от SQL инъекций
- Валидация входных данных
- Rate limiting (будущая версия)

### 5. Производительность
- Пагинация для списков
- Кэширование часто запрашиваемых данных
- Оптимизация запросов к БД
- Асинхронная обработка тяжелых операций

### 6. Логирование
- Структурированные логи
- Логирование всех важных операций
- Разные уровни логирования для разных окружений
- Мониторинг производительности

### 7. Тестирование
- Unit тесты для всех сервисов
- Интеграционные тесты для API
- Тесты для репозиториев
- Мокирование внешних сервисов

## Дополнительные требования

### 1. Документация
- Автоматическая генерация OpenAPI документации
- Swagger UI для тестирования API
- README с инструкциями по запуску
- Документация по развертыванию

### 2. Конфигурация
- Поддержка разных профилей (dev, test, prod)
- Конфигурация через application.yml
- Переменные окружения для секретов
- Конфигурация базы данных

### 3. Мониторинг
- Health check endpoints
- Метрики производительности
- Мониторинг состояния БД
- Алерты при критических ошибках

### 4. Развертывание
- Docker контейнеризация
- Docker Compose для локальной разработки
- CI/CD pipeline
- Автоматические тесты при деплое

## Текущее состояние фронтенда

Фронтенд использует mock API для демонстрации функциональности. Все методы mock API должны быть реализованы в бэкенде:

### Основные методы для реализации:
- `login(email, password)` - аутентификация
- `getAccount()` - получение профиля пользователя
- `getPositions()` - список вакансий
- `createPosition()` - создание вакансии
- `getPosition()` - получение вакансии
- `updatePosition()` - обновление вакансии
- `deletePosition()` - удаление вакансии
- `getQuestions()` - вопросы по вакансии
- `createQuestion()` - создание вопроса
- `updateQuestion()` - обновление вопроса
- `deleteQuestion()` - удаление вопроса
- `getCandidates()` - кандидаты по вакансии
- `createCandidate()` - создание кандидата
- `updateCandidate()` - обновление кандидата
- `deleteCandidate()` - удаление кандидата
- `getInterviews()` - список собеседований
- `submitInterviewAnswer()` - отправка ответа
- `finishInterview()` - завершение собеседования
- `getStats()` - статистика
- `getReports()` - отчеты
- `getBranding()` - настройки брендинга
- `updateBranding()` - обновление брендинга
- `getUsers()` - список пользователей
- `createUser()` - создание пользователя
- `updateUser()` - обновление пользователя
- `deleteUser()` - удаление пользователя
- `getTariffs()` - список тарифов
- `createTariff()` - создание тарифа
- `updateTariff()` - обновление тарифа
- `deleteTariff()` - удаление тарифа
- `transcribeAudio()` - транскрибация аудио
- `generateQuestions()` - генерация вопросов
- `createInterviewFromCandidate()` - создание собеседования из кандидата
- `getInterviewDetails()` - получение детальной информации о собеседовании
- `listInterviews()` - список собеседований с фильтрацией
- `getInterviewsByPosition()` - собеседования по вакансии
- `transcribeInterviewAnswer()` - транскрибация ответа на вопрос

Все эти методы должны быть реализованы в соответствии с OpenAPI спецификацией. 